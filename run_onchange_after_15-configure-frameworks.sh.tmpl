#!/usr/bin/env bash
# profile: {{ .profile | default "dev" }}

set -e

{{- $profile := .profile | default "dev" }}

echo "ðŸ“¦ Framework configuration"

# Setup/Update Zsh Prezto
echo "Configuring Zsh Prezto..."
prezto_dir="${ZDOTDIR:-{{ .chezmoi.homeDir }}}/.zprezto"

if [ -d "$prezto_dir" ]; then
    cd "$prezto_dir"
    git pull --quiet
    git submodule update --init --recursive --quiet
    echo "âœ“ Prezto updated"
else
    git clone --recursive --quiet https://github.com/sorin-ionescu/prezto.git "$prezto_dir"
    echo "âœ“ Prezto installed"
fi

{{- if or (eq $profile "dev") (eq $profile "mac") }}
# Configure gopass (dev/mac profiles only)
if command -v gopass >/dev/null 2>&1; then
    echo "Configuring gopass..."
    gopass config show.safecontent true >/dev/null 2>&1
    gopass config show.autoclip false >/dev/null 2>&1
    gopass config core.notifications false >/dev/null 2>&1

    # Configure push remotes
    gopass git remote set-url --add --push origin {{ .gopass_push_url_1 | quote }} >/dev/null 2>&1
    gopass git remote set-url --add --push origin {{ .gopass_push_url_2 | quote }} >/dev/null 2>&1
    echo "âœ“ gopass configured"
else
    echo "â„¹ gopass not found, skipping gopass configuration"
fi
{{- end }}

echo "âœ“ Framework configuration complete"
