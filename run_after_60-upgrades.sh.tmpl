{{ if or (lookPath "brew") (lookPath "opencode") -}}
#!/usr/bin/env bash
{{ template "helpers.sh" . }}

section "Upgrades"

# Ensure Homebrew is in PATH if installed
{{ if eq .chezmoi.os "darwin" -}}
if [ -f "/opt/homebrew/bin/brew" ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
fi
{{- end }}
{{ if eq .chezmoi.os "linux" -}}
if [ -f "/home/linuxbrew/.linuxbrew/bin/brew" ]; then
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi
{{- end }}

{{ if lookPath "brew" -}}
progress "Homebrew update"
if brew update >/dev/null 2>&1; then
    finish
else
    failed
    exit 1
fi

progress "Homebrew upgrade"
if brew upgrade >/dev/null 2>&1; then
    finish
else
    failed
    exit 1
fi
{{ end -}}

{{ if lookPath "opencode" -}}
progress "OpenCode"
if opencode upgrade >/dev/null 2>&1; then
    finish
else
    warn "OpenCode upgrade failed or skipped"
fi
{{ end -}}
{{ end -}}
