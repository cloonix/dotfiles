#!/bin/zsh
# Change default shell to zsh

{{- template "helpers.sh" . }}

if ! command -v zsh >/dev/null 2>&1; then
    warn "zsh not found, skipping shell change"
    exit 0
fi

zsh_path=$(which zsh)

# Determine current shell
current_shell=""
if command -v getent >/dev/null 2>&1; then
    current_shell=$(getent passwd "$USER" | cut -d: -f7)
else
    current_shell=$(dscl . -read "/Users/$USER" UserShell 2>/dev/null | awk '{print $2}')
fi

if [[ "$current_shell" != "$zsh_path" ]]; then
    progress "Shell"
    log "Changing shell to zsh ($zsh_path)"

    if chsh -s "$zsh_path" >/dev/null 2>&1 || sudo chsh -s "$zsh_path" "$USER" >/dev/null 2>&1; then
        finish
        success "Shell changed to zsh. Please log out and log back in for changes to take effect."
    else
        failed
        warn "Could not change shell. You may need to do this manually: chsh -s $zsh_path"
        exit 1
    fi
else
    success "Shell is already zsh"
fi
