#!/bin/zsh
# Link Prezto runcoms after chezmoi applies custom configs

{{- template "helpers.sh" . }}

zprezto_dir="${ZDOTDIR:-{{ .chezmoi.homeDir }}}/.zprezto"

if [[ ! -d "$zprezto_dir" ]]; then
    warn "Prezto not installed, skipping"
    exit 0
fi

progress "Prezto runcoms"

setopt EXTENDED_GLOB
success_flag=true

# Link prezto runcoms (skip zshrc and zpreztorc managed by chezmoi)
for rcfile in "$zprezto_dir"/runcoms/^README.md(.N); do
    [[ "$rcfile:t" == "zshrc" || "$rcfile:t" == "zpreztorc" ]] && continue
    link_file "$rcfile" "${ZDOTDIR:-{{ .chezmoi.homeDir }}}/.$rcfile:t" || success_flag=false
done

if [[ "$success_flag" == true ]]; then
    finish
else
    failed
    exit 1
fi
