[mgr]
show_hidden = false
ratio = [1, 4, 3]  # Larger middle column for better file viewing
linemode = "size_and_mtime"
sort_by = "natural"
sort_sensitive = false
sort_reverse = false
sort_dir_first = true
scrolloff = 5  # Keep cursor away from edges
show_symlink = true  # Show symlink paths for better clarity
title_format = "Yazi: {cwd}"  # Better terminal title

[preview]
max_width = 2500
max_height = 2500
image_delay = 50  # Faster image preview rendering
cache_dir = ""
ueberzug_scale = 1.0
ueberzug_offset = [0, 0, 0, 0]
tab_size = 2
wrap = "no"

[tasks]
# Visual task progress indicators
micro_workers = 5
macro_workers = 10
bizarre_retry = 5
image_alloc = 536870912  # 512MB
image_bound = [0, 0]
suppress_preload = false

[plugin]
[[plugin.prepend_previewers]]
url = "*.md"
run  = 'piper -- CLICOLOR_FORCE=1 glow -s ~/.config/yazi/glow/tokyo_night.json -w=$w "$1"'

[[plugin.prepend_fetchers]]
id   = "git"
name = "*"
run  = "git"

[[plugin.prepend_fetchers]]
id   = "git"
name = "*/"
run  = "git"

[open]
rules = [
    { url = "*/", use = [ "edit", "code", "ncdu", "archive" ] },
{{- if lookPath "open" }}
{{-   $typoraPath := "/Applications/Typora.app" }}
{{-   if stat $typoraPath }}
    { url = "*.{md,MD,markdown}", use = [ "typora", "edit", "code", "reveal", "copy_path" ] },
{{-   end }}
{{- end }}
    { url = "*.{pdf,PDF}", use = [ "open_default", "reveal", "copy_path" ] },
    { url = "*.{doc,docx,xls,xlsx,ppt,pptx,DOC,DOCX,XLS,XLSX,PPT,PPTX}", use = [ "open_default", "reveal", "copy_path" ] },
    { url = "*.{7z,zip,rar,tar,gz,bz2,xz,Z}", use = [ "extract", "reveal", "copy_path" ] },
    { url = "*", use = [ "edit", "code", "reveal", "archive", "copy_path" ] },
]

[opener]
{{- if lookPath "open" }}
{{-   $typoraPath := "/Applications/Typora.app" }}
{{-   if stat $typoraPath }}
typora = [
    { run = 'open -a Typora "$1"', orphan = true, desc = "ğŸ“„ Typora", for = "macos" },
]

{{-   end }}
{{- end }}
edit = [
    { run = 'nvim "$@"', block = true, desc = "ğŸ“ Neovim", for = "macos" },
    { run = 'command -v nvim >/dev/null && nvim "$@" || vim "$@"', block = true, desc = "ğŸ“ Editor", for = "linux" },
]

code = [
    { run = 'code "$1"', orphan = true, desc = "ğŸ’» Visual Studio Code", for = "macos" },
    { run = 'code "$1"', orphan = true, desc = "ğŸ’» Visual Studio Code", for = "unix" },
]

ncdu = [
    { run = 'ncdu --color dark "$1"', block = true, desc = "Ncdu", for = "macos" },
    { run = 'ncdu --color dark "$1"', block = true, desc = "Ncdu", for = "unix" },
]

reveal = [
    { run = 'open -R "$1"', orphan = true, desc = "ğŸ“ Reveal in Finder", for = "macos" },
]

archive = [
    { run = '7zz a "$1.7z" "$1" && echo "âœ… Archived to $1.7z"', desc = "ğŸ“¦ Archive (7zip)", for = "macos" },
]

extract = [
    { run = '7zz x "$1" -o"${1%.*}" && echo "âœ… Extracted to ${1%.*}/"', desc = "ğŸ“¦ Extract Archive", for = "macos" },
]

copy_path = [
    { run = 'echo "$1" | pbcopy && echo "ğŸ“‹ Path copied to clipboard"', orphan = true, desc = "ğŸ“‹ Copy Path", for = "macos" },
]

open_default = [
    { run = 'open "$1"', orphan = true, desc = "ğŸš€ Open with Default App", for = "macos" },
]
