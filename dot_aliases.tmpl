alias vi="nvim"
alias vim="nvim"
alias view="nvim -R"

alias gitpullall='for d in ~/git/*/.git; do (cd "${d%/.git}" && echo "Updating $(basename "$PWD")" && git pull); done'

# Check all subdirectories for uncommitted/unpushed git changes
gitstatus() {
  local dir="${1:-.}"
  local found_issues=false
  
  for d in "$dir"/*/.git; do
    [ -d "$d" ] || continue
    local repo_dir="${d%/.git}"
    local repo_name=$(basename "$repo_dir")
    
    cd "$repo_dir" || continue
    local status_msg=""
    
    # Check for uncommitted changes
    if ! git diff-index --quiet HEAD -- 2>/dev/null; then
      status_msg="uncommitted changes"
    fi
    
    # Check for unpushed commits
    local unpushed=$(git rev-list @{u}..HEAD --count 2>/dev/null)
    if [ -n "$unpushed" ] && [ "$unpushed" -gt 0 ]; then
      [ -n "$status_msg" ] && status_msg="${status_msg}, "
      status_msg="${status_msg}${unpushed} unpushed commit(s)"
    fi
    
    if [ -n "$status_msg" ]; then
      printf "\033[1;33m%s:\033[0m %s\n" "$repo_name" "$status_msg"
      found_issues=true
    fi
    
    cd - >/dev/null || return
  done
  
  if [ "$found_issues" = false ]; then
    echo "âœ“ All repositories are clean and up to date"
  fi
}

# dstask aliases (runtime check)
if command -v dstask >/dev/null 2>&1; then
  alias t="dstask"
  alias ta="dstask add"
  alias tc="dstask context"
  alias tcc="dstask context --"
  alias td="dstask done"
  alias te="dstask edit"
  alias th="dstask help"
  alias tl="dstask log"
  alias tm="dstask modify"
  alias tn="dstask note"
  alias to="dstask open"
  alias tr="dstask remove"
  alias tsp="dstask show-projects"
  alias tst="dstask show-tags"
  alias tsa="dstask show-active"
  alias tso="dstask show-open"
  alias tsr="dstask show-resolved"
  alias tsu="dstask show-unorganised"
  alias tsy="dstask sync"
fi

alias pass=gopass
alias fabric="fabric-ai"
alias f="fabric-ai"

# Darwin-specific aliases
{{- if eq .chezmoi.os "darwin" }}
  alias pp="pbpaste"
  alias pc="pbcopy"
{{- end }}

# Mac profile aliases
{{- if eq .profile "mac" }}
  alias typora="open -a typora"
{{- end }}

if command -v zellij >/dev/null 2>&1; then
  # Note: 'z' is reserved for zoxide (smart directory jumping)
  alias zj="zellij"
  alias zjl="zellij ls"
  alias zja="zellij a"
  alias zjs="zellij -s"
fi

if command -v opencode >/dev/null 2>&1; then
  alias oc="opencode"

  ocw() {
    export OPENCODE_WORK_DATA="$HOME/.local/share-work/"
    export OPENCODE_WORK_CONFIG="$HOME/.config-work/opencode"

    mkdir -p "$OPENCODE_WORK_CONFIG"

    XDG_DATA_HOME="$OPENCODE_WORK_DATA" \
    OPENCODE_CONFIG_DIR="$OPENCODE_WORK_CONFIG" \
    opencode
  }
fi

yts() {
  if ! command -v ytt >/dev/null 2>&1; then
    echo "Error: ytt not found" >&2
    return 1
  fi
  if ! command -v glow >/dev/null 2>&1; then
    echo "Error: glow not found" >&2
    return 1
  fi
  
  local lang="en"
  local f_lang="en"

  while [[ $# -gt 0 ]]; do
    case "$1" in
      -l)
        lang="$2"
        shift 2
        ;;
      -g=*)
        f_lang="${1#-g=}"
        shift
        ;;
      *)
        break
        ;;
    esac
  done

  ytt -l "$lang" "$@" \
    | f -g="$f_lang" -p youtube_summary \
    | glow -p
}
